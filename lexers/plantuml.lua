-- Show PlantUML keywords: `java -Djava.awt.headless=true -jar plantuml.jar  -language`

local lexer = require('lexer')
local token, word_match = lexer.token, lexer.word_match
local P, S = lpeg.P, lpeg.S

local lex = lexer.new('plantuml', {fold_by_indentation = true})

-- Whitespace.
lex:add_rule('whitespace', token(lexer.WHITESPACE, lexer.space^1))

-- Keywords.
lex:add_rule('keyword', token(lexer.KEYWORD, word_match([[
  -- Types
  abstract actor agent archimate artifact boundary card class cloud component
  control database detach diamond entity enum file folder frame interface
  node object package participant queue rectangle stack state storage usecase

  -- Keywords
  @enddot @endjson @endsalt @enduml @startdot @startjson @startsalt @startuml
  across activate again allow_mixing allowmixing also alt as autonumber bold
  bottom box break caption center circle color create critical dashed deactivate
  description destroy dotted down else elseif empty end endif endwhile false
  footbox footer fork group header hide hnote if is italic kill left legend link
  loop mainframe map members namespace newpage normal note of on opt order over
  package page par partition plain ref repeat return right rnote rotate show skin
  skinparam split sprite start stereotype stop style then title top top to bottom
  direction true up while
]], true)))

-- Preprocessors.
lex:add_rule('preprocessor', token(lexer.PREPROCESSOR, word_match([[
  -- Preprocessors
  !assert !define !definelong !dump_memory !else !enddefinelong !endfunction !endif
  !endprocedure !endsub !exit !function !if !ifdef !ifndef !import !include !local
  !log !pragma !procedure !return !startsub !undef !unquoted

  -- Skinparameters
  ActivityBackgroundColor ActivityBarColor ActivityBorderColor ActivityBorderThickness ActivityDiamondBackgroundColor ActivityDiamondBorderColor ActivityDiamondFontColor ActivityDiamondFontName ActivityDiamondFontSize ActivityDiamondFontStyle ActivityEndColor ActivityFontColor ActivityFontName ActivityFontSize ActivityFontStyle ActivityStartColor ActorBackgroundColor ActorBorderColor ActorFontColor ActorFontName ActorFontSize ActorFontStyle ActorStereotypeFontColor ActorStereotypeFontName ActorStereotypeFontSize ActorStereotypeFontStyle AgentBackgroundColor AgentBorderColor AgentBorderThickness AgentFontColor AgentFontName AgentFontSize AgentFontStyle AgentStereotypeFontColor AgentStereotypeFontName AgentStereotypeFontSize AgentStereotypeFontStyle ArchimateBackgroundColor ArchimateBorderColor ArchimateBorderThickness ArchimateFontColor ArchimateFontName ArchimateFontSize ArchimateFontStyle ArchimateStereotypeFontColor ArchimateStereotypeFontName ArchimateStereotypeFontSize ArchimateStereotypeFontStyle ArrowColor ArrowFontColor ArrowFontName ArrowFontSize ArrowFontStyle ArrowHeadColor ArrowLollipopColor ArrowMessageAlignment ArrowThickness ArtifactBackgroundColor ArtifactBorderColor ArtifactFontColor ArtifactFontName ArtifactFontSize ArtifactFontStyle ArtifactStereotypeFontColor ArtifactStereotypeFontName ArtifactStereotypeFontSize ArtifactStereotypeFontStyle BackgroundColor BiddableBackgroundColor BiddableBorderColor BoundaryBackgroundColor BoundaryBorderColor BoundaryFontColor BoundaryFontName BoundaryFontSize BoundaryFontStyle BoundaryStereotypeFontColor BoundaryStereotypeFontName BoundaryStereotypeFontSize BoundaryStereotypeFontStyle BoxPadding CaptionFontColor CaptionFontName CaptionFontSize CaptionFontStyle CardBackgroundColor CardBorderColor CardBorderThickness CardFontColor CardFontName CardFontSize CardFontStyle CardStereotypeFontColor CardStereotypeFontName CardStereotypeFontSize CardStereotypeFontStyle CircledCharacterFontColor CircledCharacterFontName CircledCharacterFontSize CircledCharacterFontStyle CircledCharacterRadius ClassAttributeFontColor ClassAttributeFontName ClassAttributeFontSize ClassAttributeFontStyle ClassAttributeIconSize ClassBackgroundColor ClassBorderColor ClassBorderThickness ClassFontColor ClassFontName ClassFontSize ClassFontStyle ClassHeaderBackgroundColor ClassStereotypeFontColor ClassStereotypeFontName ClassStereotypeFontSize ClassStereotypeFontStyle CloudBackgroundColor CloudBorderColor CloudFontColor CloudFontName CloudFontSize CloudFontStyle CloudStereotypeFontColor CloudStereotypeFontName CloudStereotypeFontSize CloudStereotypeFontStyle CollectionsBackgroundColor CollectionsBorderColor ColorArrowSeparationSpace ComponentBackgroundColor ComponentBorderColor ComponentBorderThickness ComponentFontColor ComponentFontName ComponentFontSize ComponentFontStyle ComponentStereotypeFontColor ComponentStereotypeFontName ComponentStereotypeFontSize ComponentStereotypeFontStyle ComponentStyle ConditionEndStyle ConditionStyle ControlBackgroundColor ControlBorderColor ControlFontColor ControlFontName ControlFontSize ControlFontStyle ControlStereotypeFontColor ControlStereotypeFontName ControlStereotypeFontSize ControlStereotypeFontStyle DatabaseBackgroundColor DatabaseBorderColor DatabaseFontColor DatabaseFontName DatabaseFontSize DatabaseFontStyle DatabaseStereotypeFontColor DatabaseStereotypeFontName DatabaseStereotypeFontSize DatabaseStereotypeFontStyle DefaultFontColor DefaultFontName DefaultFontSize DefaultFontStyle DefaultMonospacedFontName DefaultTextAlignment DesignedBackgroundColor DesignedBorderColor DesignedDomainBorderThickness DesignedDomainFontColor DesignedDomainFontName DesignedDomainFontSize DesignedDomainFontStyle DesignedDomainStereotypeFontColor DesignedDomainStereotypeFontName DesignedDomainStereotypeFontSize DesignedDomainStereotypeFontStyle DiagramBorderColor DiagramBorderThickness DomainBackgroundColor DomainBorderColor DomainBorderThickness DomainFontColor DomainFontName DomainFontSize DomainFontStyle DomainStereotypeFontColor DomainStereotypeFontName DomainStereotypeFontSize DomainStereotypeFontStyle Dpi EntityBackgroundColor EntityBorderColor EntityFontColor EntityFontName EntityFontSize EntityFontStyle EntityStereotypeFontColor EntityStereotypeFontName EntityStereotypeFontSize EntityStereotypeFontStyle EnumBackgroundColor FileBackgroundColor FileBorderColor FileFontColor FileFontName FileFontSize FileFontStyle FileStereotypeFontColor FileStereotypeFontName FileStereotypeFontSize FileStereotypeFontStyle FixCircleLabelOverlapping FolderBackgroundColor FolderBorderColor FolderFontColor FolderFontName FolderFontSize FolderFontStyle FolderStereotypeFontColor FolderStereotypeFontName FolderStereotypeFontSize FolderStereotypeFontStyle FooterFontColor FooterFontName FooterFontSize FooterFontStyle FrameBackgroundColor FrameBorderColor FrameFontColor FrameFontName FrameFontSize FrameFontStyle FrameStereotypeFontColor FrameStereotypeFontName FrameStereotypeFontSize FrameStereotypeFontStyle GenericDisplay Guillemet Handwritten HeaderFontColor HeaderFontName HeaderFontSize HeaderFontStyle HexagonBackgroundColor HexagonBorderColor HexagonBorderThickness HexagonFontColor HexagonFontName HexagonFontSize HexagonFontStyle HexagonStereotypeFontColor HexagonStereotypeFontName HexagonStereotypeFontSize HexagonStereotypeFontStyle HyperlinkColor HyperlinkUnderline IconIEMandatoryColor IconPackageBackgroundColor IconPackageColor IconPrivateBackgroundColor IconPrivateColor IconProtectedBackgroundColor IconProtectedColor IconPublicBackgroundColor IconPublicColor InterfaceBackgroundColor InterfaceBorderColor InterfaceFontColor InterfaceFontName InterfaceFontSize InterfaceFontStyle InterfaceStereotypeFontColor InterfaceStereotypeFontName InterfaceStereotypeFontSize InterfaceStereotypeFontStyle LabelFontColor LabelFontName LabelFontSize LabelFontStyle LabelStereotypeFontColor LabelStereotypeFontName LabelStereotypeFontSize LabelStereotypeFontStyle LegendBackgroundColor LegendBorderColor LegendBorderThickness LegendFontColor LegendFontName LegendFontSize LegendFontStyle LexicalBackgroundColor LexicalBorderColor LifelineStrategy Linetype MachineBackgroundColor MachineBorderColor MachineBorderThickness MachineFontColor MachineFontName MachineFontSize MachineFontStyle MachineStereotypeFontColor MachineStereotypeFontName MachineStereotypeFontSize MachineStereotypeFontStyle MaxAsciiMessageLength MaxMessageSize MinClassWidth Monochrome NodeBackgroundColor NodeBorderColor NodeFontColor NodeFontName NodeFontSize NodeFontStyle NodeStereotypeFontColor NodeStereotypeFontName NodeStereotypeFontSize NodeStereotypeFontStyle Nodesep NoteBackgroundColor NoteBorderColor NoteBorderThickness NoteFontColor NoteFontName NoteFontSize NoteFontStyle NoteShadowing NoteTextAlignment ObjectAttributeFontColor ObjectAttributeFontName ObjectAttributeFontSize ObjectAttributeFontStyle ObjectBackgroundColor ObjectBorderColor ObjectBorderThickness ObjectFontColor ObjectFontName ObjectFontSize ObjectFontStyle ObjectStereotypeFontColor ObjectStereotypeFontName ObjectStereotypeFontSize ObjectStereotypeFontStyle PackageBackgroundColor PackageBorderColor PackageBorderThickness PackageFontColor PackageFontName PackageFontSize PackageFontStyle PackageStereotypeFontColor PackageStereotypeFontName PackageStereotypeFontSize PackageStereotypeFontStyle PackageStyle PackageTitleAlignment Padding PageBorderColor PageExternalColor PageMargin ParticipantBackgroundColor ParticipantBorderColor ParticipantFontColor ParticipantFontName ParticipantFontSize ParticipantFontStyle ParticipantPadding ParticipantStereotypeFontColor ParticipantStereotypeFontName ParticipantStereotypeFontSize ParticipantStereotypeFontStyle PartitionBackgroundColor PartitionBorderColor PartitionBorderThickness PartitionFontColor PartitionFontName PartitionFontSize PartitionFontStyle PathHoverColor QueueBackgroundColor QueueBorderColor QueueBorderThickness QueueFontColor QueueFontName QueueFontSize QueueFontStyle QueueStereotypeFontColor QueueStereotypeFontName QueueStereotypeFontSize QueueStereotypeFontStyle Ranksep RectangleBackgroundColor RectangleBorderColor RectangleBorderThickness RectangleFontColor RectangleFontName RectangleFontSize RectangleFontStyle RectangleStereotypeFontColor RectangleStereotypeFontName RectangleStereotypeFontSize RectangleStereotypeFontStyle RequirementBackgroundColor RequirementBorderColor RequirementBorderThickness RequirementFontColor RequirementFontName RequirementFontSize RequirementFontStyle RequirementStereotypeFontColor RequirementStereotypeFontName RequirementStereotypeFontSize RequirementStereotypeFontStyle ResponseMessageBelowArrow RoundCorner SameClassWidth SequenceActorBorderThickness SequenceArrowThickness SequenceBoxBackgroundColor SequenceBoxBorderColor SequenceBoxFontColor SequenceBoxFontName SequenceBoxFontSize SequenceBoxFontStyle SequenceDelayFontColor SequenceDelayFontName SequenceDelayFontSize SequenceDelayFontStyle SequenceDividerBackgroundColor SequenceDividerBorderColor SequenceDividerBorderThickness SequenceDividerFontColor SequenceDividerFontName SequenceDividerFontSize SequenceDividerFontStyle SequenceGroupBackgroundColor SequenceGroupBodyBackgroundColor SequenceGroupBorderColor SequenceGroupBorderThickness SequenceGroupFontColor SequenceGroupFontName SequenceGroupFontSize SequenceGroupFontStyle SequenceGroupHeaderFontColor SequenceGroupHeaderFontName SequenceGroupHeaderFontSize SequenceGroupHeaderFontStyle SequenceLifeLineBackgroundColor SequenceLifeLineBorderColor SequenceLifeLineBorderThickness SequenceMessageAlignment SequenceMessageTextAlignment SequenceNewpageSeparatorColor SequenceParticipant SequenceParticipantBorderThickness SequenceReferenceAlignment SequenceReferenceBackgroundColor SequenceReferenceBorderColor SequenceReferenceBorderThickness SequenceReferenceFontColor SequenceReferenceFontName SequenceReferenceFontSize SequenceReferenceFontStyle SequenceReferenceHeaderBackgroundColor SequenceStereotypeFontColor SequenceStereotypeFontName SequenceStereotypeFontSize SequenceStereotypeFontStyle Shadowing StackBackgroundColor StackBorderColor StackFontColor StackFontName StackFontSize StackFontStyle StackStereotypeFontColor StackStereotypeFontName StackStereotypeFontSize StackStereotypeFontStyle StateAttributeFontColor StateAttributeFontName StateAttributeFontSize StateAttributeFontStyle StateBackgroundColor StateBorderColor StateEndColor StateFontColor StateFontName StateFontSize StateFontStyle StateMessageAlignment StateStartColor StereotypeABackgroundColor StereotypeABorderColor StereotypeCBackgroundColor StereotypeCBorderColor StereotypeEBackgroundColor StereotypeEBorderColor StereotypeIBackgroundColor StereotypeIBorderColor StereotypeNBackgroundColor StereotypeNBorderColor StereotypePosition StorageBackgroundColor StorageBorderColor StorageFontColor StorageFontName StorageFontSize StorageFontStyle StorageStereotypeFontColor StorageStereotypeFontName StorageStereotypeFontSize StorageStereotypeFontStyle Style SvglinkTarget SwimlaneBorderColor SwimlaneBorderThickness SwimlaneTitleBackgroundColor SwimlaneTitleFontColor SwimlaneTitleFontName SwimlaneTitleFontSize SwimlaneTitleFontStyle SwimlaneWidth SwimlaneWrapTitleWidth TabSize TimingFontColor TimingFontName TimingFontSize TimingFontStyle TitleBackgroundColor TitleBorderColor TitleBorderRoundCorner TitleBorderThickness TitleFontColor TitleFontName TitleFontSize TitleFontStyle UsecaseBackgroundColor UsecaseBorderColor UsecaseBorderThickness UsecaseFontColor UsecaseFontName UsecaseFontSize UsecaseFontStyle UsecaseStereotypeFontColor UsecaseStereotypeFontName UsecaseStereotypeFontSize UsecaseStereotypeFontStyle WrapWidth
  FooterTextAlignment ActorStyle
]], true)))

-- Constants.
-- TODO: Mark colors (#ffffff)
local newline = '\\n'
local icon = lexer.range('<&', '>')
lex:add_rule('constant', token(lexer.CONSTANT, newline + icon + word_match([[
  -- Colors
  APPLICATION AliceBlue AntiqueWhite Aqua Aquamarine Azure BUSINESS Beige Bisque Black BlanchedAlmond Blue BlueViolet Brown BurlyWood CadetBlue Chartreuse Chocolate Coral CornflowerBlue Cornsilk Crimson Cyan DarkBlue DarkCyan DarkGoldenRod DarkGray DarkGreen DarkGrey DarkKhaki DarkMagenta DarkOliveGreen DarkOrchid DarkRed DarkSalmon DarkSeaGreen DarkSlateBlue DarkSlateGray DarkSlateGrey DarkTurquoise DarkViolet Darkorange DeepPink DeepSkyBlue DimGray DimGrey DodgerBlue FireBrick FloralWhite ForestGreen Fuchsia Gainsboro GhostWhite Gold GoldenRod Gray Green GreenYellow Grey HoneyDew HotPink IMPLEMENTATION IndianRed Indigo Ivory Khaki Lavender LavenderBlush LawnGreen LemonChiffon LightBlue LightCoral LightCyan LightGoldenRodYellow LightGray LightGreen LightGrey LightPink LightSalmon LightSeaGreen LightSkyBlue LightSlateGray LightSlateGrey LightSteelBlue LightYellow Lime LimeGreen Linen MOTIVATION Magenta Maroon MediumAquaMarine MediumBlue MediumOrchid MediumPurple MediumSeaGreen MediumSlateBlue MediumSpringGreen MediumTurquoise MediumVioletRed MidnightBlue MintCream MistyRose Moccasin NavajoWhite Navy OldLace Olive OliveDrab Orange OrangeRed Orchid PHYSICAL PaleGoldenRod PaleGreen PaleTurquoise PaleVioletRed PapayaWhip PeachPuff Peru Pink Plum PowderBlue Purple Red RosyBrown RoyalBlue STRATEGY SaddleBrown Salmon SandyBrown SeaGreen SeaShell Sienna Silver SkyBlue SlateBlue SlateGray SlateGrey Snow SpringGreen SteelBlue TECHNOLOGY Tan Teal Thistle Tomato Turquoise Violet Wheat White WhiteSmoke Yellow YellowGreen

  -- OpenIconic

  -- Other
  hollow awesome
]], true)))

-- Types.
lex:add_rule('type', token(lexer.TYPE, lexer.word))

-- Strings.
lex:add_rule('string', token(lexer.STRING, lexer.range('"')))

-- Comments.
lex:add_rule('comment', token(lexer.COMMENT, lexer.to_eol('\'')))

-- Numbers.
lex:add_rule('number', token(lexer.NUMBER, lexer.number))

-- Operators.
-- TODO: Mark links properly (with endings and errors for mixed line styles)
lex:add_rule('operator', token(lexer.REGEX,
  S('-.~')
))

-- Fold points.
lex:add_fold_point(lexer.OPERATOR, '{', '}')

return lex
